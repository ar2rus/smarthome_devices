<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–ø–ª—ã–º –ø–æ–ª–æ–º</title>
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #333;
            font-size: 14px;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #bdbdbd;
            padding-bottom: 3px;
            margin-top: 5px;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        h3 {
            margin: 0;
            font-size: 0.9rem;
            color: #2c3e50;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–∞–Ω–∞–ª–∞ */
        .channelContainer {
            margin: 0 0 10px;
            padding: 8px;
            background-color: #fff;
            border-radius: 6px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ */
        .channelStatus {
            display: flex;
            align-items: center;
            width: 100%;
            margin: 8px 0;
            padding: 4px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        .statusBox {
            flex: 1;
            width: 100%;
            padding: 10px;
            margin-right: 10px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            font-size: 13px;
        }
        .statusOn {
            background-color: #43a047;
        }
        .statusOff {
            background-color: #e53935;
        }
        .statusWaiting {
            background-color: #757575;
        }
        .statusText {
            display: block;
            line-height: 1.3;
            width: 100%;
        }
        .paramGrid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 5px;
            margin-top: 5px;
            max-width: 380px;
            margin-left: 0;
            margin-right: auto;
        }
        .paramBox {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            padding: 5px;
            text-align: center;
        }
        .paramLabel {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 2px;
            color: rgba(255, 255, 255, 1);
        }
        .paramValue {
            font-size: 14px;
            font-weight: bold;
            color: #ffffff;
        }
        .paramIcon {
            font-size: 16px;
            margin-bottom: 2px;
        }
        .relayOn {
            color: #ffffff;
            font-weight: bold;
        }
        .relayOff {
            color: #ffffff;
            font-weight: bold;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
            flex-shrink: 0;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        input:checked + .slider {
            background-color: #90caf9;
        }
        input:focus + .slider {
            box-shadow: 0 0 1px #90caf9;
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }
        .slider.round {
            border-radius: 28px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        input:disabled + .slider {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è */
        .scheduleTitle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 2px 4px;
            margin-top: 5px;
            margin-bottom: 0;
            border-top: 1px solid #eee;
            background-color: #f9f9f9;
            border-radius: 4px;
            font-size: 0.85em;
        }
        .scheduleTitle h3 {
            font-size: 0.8rem;
            margin: 0;
        }
        .scheduleTitle .toggleIcon {
            font-size: 14px;
            transition: transform 0.3s;
        }
        .scheduleContent {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 2000px;
            opacity: 1;
            overflow: hidden;
            padding: 0 5px;
        }
        .scheduleContent.collapsed {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
            margin-bottom: 0;
            padding-top: 0;
            padding-bottom: 0;
        }
        .scheduleTable {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 13px;
        }
        .scheduleTable th, .scheduleTable td {
            border: 1px solid #ddd;
            padding: 6px 4px;
            text-align: center;
        }
        .scheduleTable th {
            background-color: #f2f2f2;
            font-size: 11px;
            font-weight: bold;
        }
        .tempDisplay, .timeDisplay {
            cursor: pointer;
            position: relative;
            padding: 2px 3px;
            border-radius: 3px;
        }
        .tempDisplay:hover, .timeDisplay:hover {
            background-color: #f5f5f5;
        }
        .tempInput, .timeInput {
            width: 55px;
            padding: 2px 3px;
            border: 1px solid #ccc;
            border-radius: 3px;
            text-align: center;
            font-size: 13px;
        }
        .deleteButton {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 0;
        }
        .addScheduleForm {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 10px;
            gap: 5px;
        }
        .addScheduleForm select, .addScheduleForm input {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            flex-grow: 1;
            min-width: 60px;
        }
        .addScheduleForm button {
            padding: 6px 10px;
            background-color: #66bb6a;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            flex-grow: 1;
        }
        .addScheduleForm button:hover {
            background-color: #4caf50;
        }
        #message {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 8px 15px;
            border-radius: 5px;
            color: white;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            max-width: 80%;
            z-index: 1000;
        }
        .success {
            background-color: #388e3c;
        }
        .error {
            background-color: #d32f2f;
        }
        .scheduleHint {
            margin: 8px 0;
            font-size: 0.75em;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –¢–µ–ø–ª—ã–π –ø–æ–ª –≤ –≤–∞–Ω–Ω–æ–π (–ø–æ–ª–Ω—ã–π –±–ª–æ–∫) -->
        <div class="channelContainer">
            <h2 id="bathroomFloorTitle">–¢–µ–ø–ª—ã–π –ø–æ–ª –≤ –≤–∞–Ω–Ω–æ–π</h2>
            
            <!-- –°—Ç–∞—Ç—É—Å –∫–∞–Ω–∞–ª–∞ -->
            <div class="channelStatus">
                <div class="statusBox statusOff" id="bathroomFloorStatus">
                    <span class="statusText">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="bathroomFloorEnabled">
                    <span class="slider round"></span>
                </label>
            </div>
            
            <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ -->
            <div class="scheduleTitle" onclick="toggleSchedule('bathroomFloor')">
                <h3>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
                <span class="toggleIcon" id="bathroomFloorToggle">‚ñ∂</span>
            </div>
            <div class="scheduleContent collapsed" id="bathroomFloorContent">
                <p class="scheduleHint">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                <table id="bathroomFloorTable" class="scheduleTable">
                    <tr>
                        <th>–î–µ–Ω—å</th>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </table>
                
                <div class="addScheduleForm">
                    <select id="bathroomFloorDay">
                        <option value="0">–í—Å</option>
                        <option value="1">–ü–Ω</option>
                        <option value="2">–í—Ç</option>
                        <option value="3">–°—Ä</option>
                        <option value="4">–ß—Ç</option>
                        <option value="5">–ü—Ç</option>
                        <option value="6">–°–±</option>
                        <option value="-1">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                        <option value="-2">–ë—É–¥–Ω–∏</option>
                        <option value="-3">–í—ã—Ö–æ–¥–Ω—ã–µ</option>
                    </select>
                    <input type="number" id="bathroomFloorHour" min="0" max="23" placeholder="–ß–∞—Å">
                    <input type="number" id="bathroomFloorMinute" min="0" max="59" placeholder="–ú–∏–Ω">
                    <input type="number" id="bathroomFloorTemp" min="0" max="50" step="0.5" placeholder="¬∞C">
                    <button id="bathroomFloorAddButton">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>
        
        <!-- –¢–µ–ø–ª–∞—è —Å—Ç–µ–Ω–∞ –≤ –≤–∞–Ω–Ω–æ–π (–ø–æ–ª–Ω—ã–π –±–ª–æ–∫) -->
        <div class="channelContainer">
            <h2 id="bathroomWallTitle">–¢–µ–ø–ª–∞—è —Å—Ç–µ–Ω–∞ –≤ –≤–∞–Ω–Ω–æ–π</h2>
            
            <!-- –°—Ç–∞—Ç—É—Å –∫–∞–Ω–∞–ª–∞ -->
            <div class="channelStatus">
                <div class="statusBox statusOff" id="bathroomWallStatus">
                    <span class="statusText">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="bathroomWallEnabled">
                    <span class="slider round"></span>
                </label>
            </div>
            
            <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ -->
            <div class="scheduleTitle" onclick="toggleSchedule('bathroomWall')">
                <h3>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
                <span class="toggleIcon" id="bathroomWallToggle">‚ñ∂</span>
            </div>
            <div class="scheduleContent collapsed" id="bathroomWallContent">
                <p class="scheduleHint">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                <table id="bathroomWallTable" class="scheduleTable">
                    <tr>
                        <th>–î–µ–Ω—å</th>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </table>
                
                <div class="addScheduleForm">
                    <select id="bathroomWallDay">
                        <option value="0">–í—Å</option>
                        <option value="1">–ü–Ω</option>
                        <option value="2">–í—Ç</option>
                        <option value="3">–°—Ä</option>
                        <option value="4">–ß—Ç</option>
                        <option value="5">–ü—Ç</option>
                        <option value="6">–°–±</option>
                        <option value="-1">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                        <option value="-2">–ë—É–¥–Ω–∏</option>
                        <option value="-3">–í—ã—Ö–æ–¥–Ω—ã–µ</option>
                    </select>
                    <input type="number" id="bathroomWallHour" min="0" max="23" placeholder="–ß–∞—Å">
                    <input type="number" id="bathroomWallMinute" min="0" max="59" placeholder="–ú–∏–Ω">
                    <input type="number" id="bathroomWallTemp" min="0" max="50" step="0.5" placeholder="¬∞C">
                    <button id="bathroomWallAddButton">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>
        
        <!-- –¢–µ–ø–ª—ã–π –ø–æ–ª –≤ —Ç—É–∞–ª–µ—Ç–µ (–ø–æ–ª–Ω—ã–π –±–ª–æ–∫) -->
        <div class="channelContainer">
            <h2 id="toiletFloorTitle">–¢–µ–ø–ª—ã–π –ø–æ–ª –≤ —Ç—É–∞–ª–µ—Ç–µ</h2>
            
            <!-- –°—Ç–∞—Ç—É—Å –∫–∞–Ω–∞–ª–∞ -->
            <div class="channelStatus">
                <div class="statusBox statusOff" id="toiletFloorStatus">
                    <span class="statusText">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="toiletFloorEnabled">
                    <span class="slider round"></span>
                </label>
            </div>
            
            <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ -->
            <div class="scheduleTitle" onclick="toggleSchedule('toiletFloor')">
                <h3>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
                <span class="toggleIcon" id="toiletFloorToggle">‚ñ∂</span>
            </div>
            <div class="scheduleContent collapsed" id="toiletFloorContent">
                <p class="scheduleHint">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                <table id="toiletFloorTable" class="scheduleTable">
                    <tr>
                        <th>–î–µ–Ω—å</th>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </table>
                
                <div class="addScheduleForm">
                    <select id="toiletFloorDay">
                        <option value="0">–í—Å</option>
                        <option value="1">–ü–Ω</option>
                        <option value="2">–í—Ç</option>
                        <option value="3">–°—Ä</option>
                        <option value="4">–ß—Ç</option>
                        <option value="5">–ü—Ç</option>
                        <option value="6">–°–±</option>
                        <option value="-1">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                        <option value="-2">–ë—É–¥–Ω–∏</option>
                        <option value="-3">–í—ã—Ö–æ–¥–Ω—ã–µ</option>
                    </select>
                    <input type="number" id="toiletFloorHour" min="0" max="23" placeholder="–ß–∞—Å">
                    <input type="number" id="toiletFloorMinute" min="0" max="59" placeholder="–ú–∏–Ω">
                    <input type="number" id="toiletFloorTemp" min="0" max="50" step="0.5" placeholder="¬∞C">
                    <button id="toiletFloorAddButton">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>
        
        <!-- –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä —Ç—É–∞–ª–µ—Ç–∞ (–ø–æ–ª–Ω—ã–π –±–ª–æ–∫) -->
        <div class="channelContainer">
            <h2 id="toiletFanTitle">–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä —Ç—É–∞–ª–µ—Ç–∞</h2>
            
            <!-- –°—Ç–∞—Ç—É—Å –∫–∞–Ω–∞–ª–∞ -->
            <div class="channelStatus">
                <div class="statusBox statusOff" id="toiletFanStatus">
                    <span class="statusText">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="toiletFanEnabled">
                    <span class="slider round"></span>
                </label>
            </div>
        </div>
        
        <!-- –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –≤–∞–Ω–Ω–æ–π (–ø–æ–ª–Ω—ã–π –±–ª–æ–∫) -->
        <div class="channelContainer">
            <h2 id="bathroomFanTitle">–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –≤–∞–Ω–Ω–æ–π</h2>
            
            <!-- –°—Ç–∞—Ç—É—Å –∫–∞–Ω–∞–ª–∞ -->
            <div class="channelStatus">
                <div class="statusBox statusOff" id="bathroomFanStatus">
                    <span class="statusText">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="bathroomFanEnabled">
                    <span class="slider round"></span>
                </label>
            </div>
        </div>
        
        <div id="message"></div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        let connectionLostTime = null;
        let connectionCheckTimer = null;
        
        // –õ–æ–∫–∞–ª–∏–∑—É–µ–º —Ç–µ–∫—Å—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
        function showMessage(text, type) {
            const messageElement = document.getElementById('message');
            messageElement.textContent = text;
            messageElement.className = type;
            messageElement.style.opacity = 1;
            
            setTimeout(() => {
                messageElement.style.opacity = 0;
            }, 3000);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞
        function loadHeatingState() {
            fetch('/api/heatfloor/state')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ' + response.status);
                    }
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –ø–æ—Ç–µ—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —Ç.–∫. —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
                    if (connectionLostTime !== null) {
                        connectionLostTime = null;
                        clearInterval(connectionCheckTimer);
                        connectionCheckTimer = null;
                    }
                    
                    return response.json();
                })
                .then(data => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ
                    if (!data || Object.keys(data).length === 0) {
                        throw new Error('–ü–æ–ª—É—á–µ–Ω—ã –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ');
                    }
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
                    for (const channelId in data) {
                        const channel = data[channelId];
                        
                        // –ï—Å–ª–∏ –µ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
                        const statusElement = document.getElementById(channelId + 'Status');
                        if (statusElement) {
                            if (channel.on) {
                                // –ò—Å–∫–ª—é—á–∞–µ–º –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä —Ç—É–∞–ª–µ—Ç–∞ –∏–∑ —ç—Ç–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, —Ç.–∫. –¥–ª—è –Ω–µ–≥–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π API
                                if (channelId !== 'toiletFan') {
                                    const currentTemp = channel.currentTemperature.toFixed(1);
                                    const desiredTemp = channel.desiredTemperature.toFixed(1);
                                    const relayClass = channel.relayState ? 'relayOn' : 'relayOff';
                                    const relayStatus = channel.relayState ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–æ—Ç–∫–ª—é—á–µ–Ω–æ';
                                    
                                    statusElement.innerHTML = `
                                        <span class="statusText">
                                            <div class="paramGrid">
                                                <div class="paramBox">
                                                    <span class="paramIcon">üå°Ô∏è</span>
                                                    <span class="paramLabel">–¢–µ–∫—É—â–∞—è t¬∞C</span>
                                                    <span class="paramValue">${currentTemp}</span>
                                                </div>
                                                <div class="paramBox">
                                                    <span class="paramIcon">‚öôÔ∏è</span>
                                                    <span class="paramLabel">–ó–∞–¥–∞–Ω–Ω–∞—è t¬∞C</span>
                                                    <span class="paramValue">${desiredTemp}</span>
                                                </div>
                                                <div class="paramBox">
                                                    <span class="paramIcon">‚ö°</span>
                                                    <span class="paramLabel">–†–µ–ª–µ</span>
                                                    <span class="paramValue ${relayClass}">${relayStatus}</span>
                                                </div>
                                            </div>
                                        </span>`;
                                    statusElement.classList.remove('statusOff', 'statusWaiting');
                                    statusElement.classList.add('statusOn');
                                }
                            } else {
                                // –ò—Å–∫–ª—é—á–∞–µ–º –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä —Ç—É–∞–ª–µ—Ç–∞ –∏–∑ —ç—Ç–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, —Ç.–∫. –¥–ª—è –Ω–µ–≥–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π API
                                if (channelId !== 'toiletFan') {
                                    statusElement.innerHTML = '<span class="statusText">–û—Ç–∫–ª—é—á–µ–Ω–æ</span>';
                                    statusElement.classList.remove('statusOn', 'statusWaiting');
                                    statusElement.classList.add('statusOff');
                                }
                            }
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π (–∫—Ä–æ–º–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞)
                        if (channelId !== 'toiletFan') {
                            const checkbox = document.getElementById(channelId + 'Enabled');
                            if (checkbox) {
                                checkbox.checked = channel.on;
                                checkbox.disabled = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
                            }
                        }
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞:', error);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –ø–æ—Ç–µ—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–æ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
                    if (connectionLostTime === null) {
                        connectionLostTime = new Date();
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Ä—ã–π —Ñ–æ–Ω (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è)
                        document.querySelectorAll('[id$="Status"]').forEach(statusElement => {
                            // –ò—Å–∫–ª—é—á–∞–µ–º –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä —Ç—É–∞–ª–µ—Ç–∞
                            if (statusElement.id !== 'toiletFanStatus') {
                                statusElement.innerHTML = '<span class="statusText">–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...</span>';
                                statusElement.classList.remove('statusOn', 'statusOff');
                                statusElement.classList.add('statusWaiting');
                            }
                        });
                        
                        // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ (–∫—Ä–æ–º–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞)
                        document.querySelectorAll('[id$="Enabled"]').forEach(checkbox => {
                            if (checkbox.id !== 'toiletFanEnabled') {
                                checkbox.disabled = true;
                            }
                        });
                        
                        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ—Ç–µ—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                        if (!connectionCheckTimer) {
                            connectionCheckTimer = setInterval(() => {
                                const now = new Date();
                                const elapsedSeconds = (now - connectionLostTime) / 1000;
                                
                                // –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª–µ–µ 60 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                                if (elapsedSeconds > 60) {
                                    document.querySelectorAll('[id$="Status"]').forEach(statusElement => {
                                        // –ò—Å–∫–ª—é—á–∞–µ–º –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä —Ç—É–∞–ª–µ—Ç–∞
                                        if (statusElement.id !== 'toiletFanStatus') {
                                            statusElement.innerHTML = '<span class="statusText">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</span>';
                                            statusElement.classList.remove('statusOn', 'statusWaiting');
                                            statusElement.classList.add('statusOff');
                                        }
                                    });
                                    
                                    // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä, —Ç.–∫. —É–∂–µ –ø–æ–∫–∞–∑–∞–ª–∏ –æ—à–∏–±–∫—É
                                    clearInterval(connectionCheckTimer);
                                    connectionCheckTimer = null;
                                }
                            }, 5000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
                        }
                    }
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ—Ö –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–≤
        function loadFanState() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ —Ç—É–∞–ª–µ—Ç–∞
            loadFanChannelState('toiletFan');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ –≤–∞–Ω–Ω–æ–π
            loadFanChannelState('bathroomFan');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞
        function loadFanChannelState(channelId) {
            fetch(`/api/fan/state?channel=${channelId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–µ ${channelId}: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ
                    if (!data) {
                        throw new Error(`–ü–æ–ª—É—á–µ–Ω—ã –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–µ ${channelId}`);
                    }
                    
                    const statusElement = document.getElementById(`${channelId}Status`);
                    const checkbox = document.getElementById(`${channelId}Enabled`);
                    
                    if (statusElement) {
                        if (data.on) {
                            const remainingTime = data.remainingTime || 0;
                            const remainingMinutes = Math.floor(remainingTime / 60);
                            const remainingSeconds = Math.floor(remainingTime % 60);
                            const timeStr = `${remainingMinutes}:${remainingSeconds.toString().padStart(2, '0')}`;
                            
                            statusElement.innerHTML = `
                                <span class="statusText">
                                    <div class="paramGrid">
                                        <div class="paramBox">
                                            <span class="paramIcon">‚è±Ô∏è</span>
                                            <span class="paramLabel">–û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è</span>
                                            <span class="paramValue">${timeStr}</span>
                                        </div>
                                        <div class="paramBox">
                                            <span class="paramIcon">‚ö°</span>
                                            <span class="paramLabel">–°—Ç–∞—Ç—É—Å</span>
                                            <span class="paramValue relayOn">–≤–∫–ª—é—á–µ–Ω–æ</span>
                                        </div>
                                    </div>
                                </span>`;
                            statusElement.classList.remove('statusOff', 'statusWaiting');
                            statusElement.classList.add('statusOn');
                        } else {
                            statusElement.innerHTML = '<span class="statusText">–û—Ç–∫–ª—é—á–µ–Ω–æ</span>';
                            statusElement.classList.remove('statusOn', 'statusWaiting');
                            statusElement.classList.add('statusOff');
                        }
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
                    // (—ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –º–µ—Ä—Ü–∞–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏)
                    if (checkbox) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (–∏–¥–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ)
                        if (!checkbox.disabled) {
                            checkbox.checked = data.on;
                        }
                        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
                        checkbox.disabled = false;
                    }
                })
                .catch(error => {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ ${channelId}:`, error);
                    
                    const statusElement = document.getElementById(`${channelId}Status`);
                    if (statusElement) {
                        statusElement.innerHTML = '<span class="statusText">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</span>';
                        statusElement.classList.remove('statusOn', 'statusWaiting');
                        statusElement.classList.add('statusOff');
                    }
                    
                    const checkbox = document.getElementById(`${channelId}Enabled`);
                    if (checkbox) {
                        checkbox.disabled = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
                    }
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞
        function toggleFan(channelId) {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –Ω–∞ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
            const checkbox = document.getElementById(`${channelId}Enabled`);
            if (checkbox) {
                checkbox.disabled = true;
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º JSON –æ–±—ä–µ–∫—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º toggle
            const requestData = {
                channel: channelId,
                state: "toggle"
            };
            
            fetch('/api/fan/control', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`–û—à–∏–±–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–º ${channelId}: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(`–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ ${channelId}:`, data);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
                    if (data.success) {
                        // –ü—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–∏—à–ª–æ —Å —Å–µ—Ä–≤–µ—Ä–∞
                        showMessage(data.message, 'success');
                        
                        // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                        loadFanChannelState(channelId);
                    } else {
                        showMessage('–û—à–∏–±–∫–∞: ' + (data.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                        
                        // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—ã—Ç–∞–µ–º—Å—è —É–∑–Ω–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                        setTimeout(() => loadFanChannelState(channelId), 1000);
                    }
                })
                .catch(error => {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ ${channelId}:`, error);
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å (–ø—Ä–æ—Å—Ç–æ —É–±–∏—Ä–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É)
                    const checkbox = document.getElementById(`${channelId}Enabled`);
                    if (checkbox) {
                        checkbox.disabled = false;
                    }
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–æ—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è" –≤ –±–ª–æ–∫–µ —Å—Ç–∞—Ç—É—Å–∞
                    const statusElement = document.getElementById(`${channelId}Status`);
                    if (statusElement) {
                        statusElement.innerHTML = '<span class="statusText">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</span>';
                        statusElement.classList.remove('statusOn', 'statusWaiting');
                        statusElement.classList.add('statusOff');
                    }
                    
                    showMessage(`–û—à–∏–±–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–º ${channelId}`, 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞
        function loadHeatingSettings() {
            fetch('/api/heatfloor/settings')
                .then(response => response.json())
                .then(data => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å –º–∞—Å—Å–∏–≤ –∫–∞–Ω–∞–ª–æ–≤
                    if (data.channels && Array.isArray(data.channels)) {
                        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –∫–∞–Ω–∞–ª –∏–∑ –º–∞—Å—Å–∏–≤–∞
                        data.channels.forEach(channel => {
                            if (!channel.name) return;
                            
                            const channelId = channel.name;
                            const displayName = channel.displayName || channelId;
                            const enabled = channel.enabled || false;
                            const schedule = channel.schedule || [];
                            
                            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                            const titleElement = document.getElementById(channelId + 'Title');
                            if (titleElement) {
                                titleElement.textContent = displayName;
                            }
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞–Ω–∞–ª–∞
                            updateScheduleTable(channelId, schedule);
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤–∫–ª—é—á–µ–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω—è—è —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞
                            const checkbox = document.getElementById(channelId + 'Enabled');
                            if (checkbox) {
                                // –ï—Å–ª–∏ —á–µ–∫–±–æ–∫—Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ª–∏ –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                                // –ï—Å–ª–∏ –º—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫, –Ω–µ –º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                                const isUpdatingSettings = document.querySelector('[id$="Enabled"]:disabled');
                                if (!isUpdatingSettings) {
                                    checkbox.checked = enabled;
                                }
                            }
                        });
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞:', error);
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞
        function toggleHeatingChannel(channelId, enabled) {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –Ω–∞ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
            const checkbox = document.getElementById(channelId + 'Enabled');
            if (checkbox) {
                checkbox.disabled = true;
            }
            
            const state = enabled ? 'on' : 'off';
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º JSON –æ–±—ä–µ–∫—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const requestData = {
                channel: channelId,
                state: state
            };
            
            fetch('/api/heatfloor/control', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:', data);
                    
                    if (data.success) {
                        // –ü—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–∏—à–ª–æ —Å —Å–µ—Ä–≤–µ—Ä–∞
                        showMessage(data.message, 'success');
                    } else {
                        showMessage('–û—à–∏–±–∫–∞: ' + (data.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                    }
                    
                    // –û–±–Ω–æ–≤–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                    setTimeout(loadHeatingState, 1000);
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∫–∞–Ω–∞–ª–∞ —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞:', error);
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è
                    if (checkbox) {
                        checkbox.checked = !enabled;
                        checkbox.disabled = false;
                    }
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–æ—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è" –≤ –±–ª–æ–∫–µ —Å—Ç–∞—Ç—É—Å–∞
                    const statusElement = document.getElementById(channelId + 'Status');
                    if (statusElement) {
                        statusElement.innerHTML = '<span class="statusText">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</span>';
                        statusElement.classList.remove('statusOn');
                        statusElement.classList.add('statusOff');
                    }
                    
                    showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∫–∞–Ω–∞–ª–∞ —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞: ' + error.message, 'error');
                });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        function updateScheduleTable(channelId, schedule) {
            const tableId = channelId + 'Table';
            const table = document.getElementById(tableId);
            if (!table) return;
            
            // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏, –∫—Ä–æ–º–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
            const rows = table.getElementsByTagName('tr');
            while (rows.length > 1) {
                table.deleteRow(1);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            schedule.forEach((item, index) => {
                const row = table.insertRow();
                
                // –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏
                const dayCell = row.insertCell();
                dayCell.textContent = getDayName(item.dayOfWeek);
                
                // –í—Ä–µ–º—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                const timeCell = row.insertCell();
                const timeDisplay = document.createElement('span');
                timeDisplay.textContent = formatTime(item.hour, item.minute);
                timeDisplay.className = 'timeDisplay';
                timeDisplay.onclick = function() {
                    // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    timeDisplay.style.display = 'none';
                    timeInput.style.display = 'inline-block';
                    timeInput.focus();
                    timeInput.select();
                };
                
                // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
                const timeInput = document.createElement('input');
                timeInput.type = 'time';
                timeInput.value = formatTimeInput(item.hour, item.minute);
                timeInput.className = 'timeInput';
                timeInput.style.display = 'none';
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
                timeInput.onblur = function() {
                    // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç
                    timeInput.style.display = 'none';
                    timeDisplay.style.display = 'inline-block';
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
                    const [hours, minutes] = timeInput.value.split(':').map(Number);
                    if (!isNaN(hours) && !isNaN(minutes) && 
                        (hours !== item.hour || minutes !== item.minute)) {
                        saveTimeChange(channelId, index, timeInput.value);
                    }
                };
                
                timeInput.onkeydown = function(event) {
                    if (event.key === 'Enter') {
                        // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç
                        timeInput.style.display = 'none';
                        timeDisplay.style.display = 'inline-block';
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
                        const [hours, minutes] = timeInput.value.split(':').map(Number);
                        if (!isNaN(hours) && !isNaN(minutes) && 
                            (hours !== item.hour || minutes !== item.minute)) {
                            saveTimeChange(channelId, index, timeInput.value);
                        }
                    } else if (event.key === 'Escape') {
                        // –û—Ç–º–µ–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                        timeInput.style.display = 'none';
                        timeDisplay.style.display = 'inline-block';
                    }
                };
                
                timeCell.appendChild(timeDisplay);
                timeCell.appendChild(timeInput);
                
                // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                const tempCell = row.insertCell();
                const tempDisplay = document.createElement('span');
                tempDisplay.textContent = item.temperature.toFixed(1) + '¬∞C';
                tempDisplay.className = 'tempDisplay';
                tempDisplay.onclick = function() {
                    // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    tempDisplay.style.display = 'none';
                    tempInput.style.display = 'inline-block';
                    tempInput.focus();
                    tempInput.select();
                };
                
                // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
                const tempInput = document.createElement('input');
                tempInput.type = 'number';
                tempInput.value = item.temperature;
                tempInput.min = 10;
                tempInput.max = 45;
                tempInput.step = 0.5;
                tempInput.className = 'tempInput';
                tempInput.style.display = 'none';
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
                tempInput.onblur = function() {
                    // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç
                    tempInput.style.display = 'none';
                    tempDisplay.style.display = 'inline-block';
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
                    const newValue = parseFloat(tempInput.value);
                    if (!isNaN(newValue) && Math.abs(newValue - item.temperature) >= 0.01) {
                        saveTemperatureChange(channelId, index, newValue);
                    }
                };
                
                tempInput.onkeydown = function(event) {
                    if (event.key === 'Enter') {
                        // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç
                        tempInput.style.display = 'none';
                        tempDisplay.style.display = 'inline-block';
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
                        const newValue = parseFloat(tempInput.value);
                        if (!isNaN(newValue) && Math.abs(newValue - item.temperature) >= 0.01) {
                            saveTemperatureChange(channelId, index, newValue);
                        }
                    } else if (event.key === 'Escape') {
                        // –û—Ç–º–µ–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                        tempInput.style.display = 'none';
                        tempDisplay.style.display = 'inline-block';
                    }
                };
                
                tempCell.appendChild(tempDisplay);
                tempCell.appendChild(tempInput);
                
                // –ö–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
                const actionsCell = row.insertCell();
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'üóëÔ∏è';
                deleteButton.className = 'deleteButton';
                deleteButton.onclick = function() {
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è?')) {
                        deleteScheduleItem(channelId, index);
                    }
                };
                actionsCell.appendChild(deleteButton);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
        function saveTemperatureChange(channelId, index, newTemperature) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è
            if (isNaN(newTemperature) || newTemperature < 10 || newTemperature > 45) {
                showMessage('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞. –î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω: 10-45¬∞C', 'error');
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                loadHeatingSettings();
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            const checkbox = document.getElementById(channelId + 'Enabled');
            const previousState = checkbox ? checkbox.checked : false;
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
            fetch('/api/heatfloor/settings')
                .then(response => response.json())
                .then(data => {
                    // –ù–∞—Ö–æ–¥–∏–º –∫–∞–Ω–∞–ª –≤ –º–∞—Å—Å–∏–≤–µ
                    let channelData = null;
                    let channelObj = null;
                    
                    if (data.channels && Array.isArray(data.channels)) {
                        channelObj = data.channels.find(ch => ch.name === channelId);
                        if (channelObj && Array.isArray(channelObj.schedule)) {
                            channelData = channelObj.schedule;
                        }
                    }
                    
                    if (!channelData || !channelData[index]) {
                        showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è', 'error');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ
                    if (Math.abs(channelData[index].temperature - newTemperature) < 0.01) {
                        console.log('–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å, –∑–∞–ø—Ä–æ—Å –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è');
                        return;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
                    channelData[index].temperature = newTemperature;
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–∏—è
                    const enabled = previousState;
                    console.log(`–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ ${channelId}: ${enabled ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω'}`);
                    
                    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                    const updatedData = {
                        channels: [
                            {
                                name: channelId,
                                enabled: enabled, // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –¥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                                schedule: channelData
                            }
                        ]
                    };
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    return fetch('/api/heatfloor/settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updatedData)
                    });
                })
                .then(response => {
                    if (!response) return null; // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
                    return response.json();
                })
                .then(result => {
                    if (!result) return; // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
                    
                    if (result.success) {
                        showMessage('–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
                        loadHeatingSettings();
                    } else {
                        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: ' + result.message, 'error');
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã:', error);
                    showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã', 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        function deleteScheduleItem(channelId, index) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            const checkbox = document.getElementById(channelId + 'Enabled');
            const previousState = checkbox ? checkbox.checked : false;
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
            fetch('/api/heatfloor/settings')
                .then(response => response.json())
                .then(data => {
                    // –ù–∞—Ö–æ–¥–∏–º –∫–∞–Ω–∞–ª –≤ –º–∞—Å—Å–∏–≤–µ
                    let channelData = null;
                    let channelObj = null;
                    
                    if (data.channels && Array.isArray(data.channels)) {
                        channelObj = data.channels.find(ch => ch.name === channelId);
                        if (channelObj && Array.isArray(channelObj.schedule)) {
                            channelData = channelObj.schedule;
                        }
                    }
                    
                    if (!channelData) {
                        showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è', 'error');
                        return;
                    }
                    
                    // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç
                    channelData.splice(index, 1);
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–∏—è
                    const enabled = previousState;
                    console.log(`–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ ${channelId}: ${enabled ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω'}`);
                    
                    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                    const updatedData = {
                        channels: [
                            {
                                name: channelId,
                                enabled: enabled, // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –¥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                                schedule: channelData
                            }
                        ]
                    };
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    return fetch('/api/heatfloor/settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updatedData)
                    });
                })
                .then(response => {
                    if (!response) return null; // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
                    return response.json();
                })
                .then(result => {
                    if (!result) return; // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
                    
                    if (result.success) {
                        showMessage('–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                        loadHeatingSettings();
                    } else {
                        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è: ' + result.message, 'error');
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:', error);
                    showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è', 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
        function addScheduleItem(channelId) {
            const daySelect = document.getElementById(channelId + 'Day');
            const hourInput = document.getElementById(channelId + 'Hour');
            const minuteInput = document.getElementById(channelId + 'Minute');
            const tempInput = document.getElementById(channelId + 'Temp');
            
            if (!daySelect || !hourInput || !minuteInput || !tempInput) {
                showMessage('–ù–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã', 'error');
                return;
            }
            
            const day = parseInt(daySelect.value);
            const hour = parseInt(hourInput.value);
            const minute = parseInt(minuteInput.value);
            const temp = parseFloat(tempInput.value);
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (isNaN(day) || isNaN(hour) || isNaN(minute) || isNaN(temp)) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'error');
                return;
            }
            
            if (hour < 0 || hour > 23 || minute < 0 || minute > 59) {
                showMessage('–ù–µ–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è. –î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω: 0-23 —á–∞—Å–æ–≤, 0-59 –º–∏–Ω—É—Ç', 'error');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            const checkbox = document.getElementById(channelId + 'Enabled');
            const previousState = checkbox ? checkbox.checked : false;
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
            fetch('/api/heatfloor/settings')
                .then(response => response.json())
                .then(data => {
                    // –ù–∞—Ö–æ–¥–∏–º –∫–∞–Ω–∞–ª –≤ –º–∞—Å—Å–∏–≤–µ
                    let channelData = [];
                    
                    if (data.channels && Array.isArray(data.channels)) {
                        const channelObj = data.channels.find(ch => ch.name === channelId);
                        if (channelObj) {
                            channelData = Array.isArray(channelObj.schedule) ? channelObj.schedule : [];
                        }
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
                    channelData.push({
                        dayOfWeek: day,
                        hour: hour,
                        minute: minute,
                        temperature: temp
                    });
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–∏—è
                    const enabled = previousState;
                    console.log(`–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ ${channelId}: ${enabled ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω'}`);
                    
                    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                    const updatedData = {
                        channels: [
                            {
                                name: channelId,
                                enabled: enabled, // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –¥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                                schedule: channelData
                            }
                        ]
                    };
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    return fetch('/api/heatfloor/settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updatedData)
                    });
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                        daySelect.selectedIndex = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
                        hourInput.value = '';
                        minuteInput.value = '';
                        tempInput.value = '';
                        
                        showMessage('–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                        loadHeatingSettings();
                    } else {
                        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è: ' + result.message, 'error');
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:', error);
                    showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è', 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
        function saveTimeChange(channelId, index, newTime) {
            // –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∞—Å—ã –∏ –º–∏–Ω—É—Ç—ã –∏–∑ —Å—Ç—Ä–æ–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ (—Ñ–æ—Ä–º–∞—Ç HH:MM)
            const [hours, minutes] = newTime.split(':').map(Number);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è
            if (isNaN(hours) || isNaN(minutes) || hours < 0 || hours > 23 || minutes < 0 || minutes > 59) {
                showMessage('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—Ä–µ–º—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç –ß–ß:–ú–ú (0-23 —á–∞—Å–æ–≤, 0-59 –º–∏–Ω—É—Ç)', 'error');
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                loadHeatingSettings();
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            const checkbox = document.getElementById(channelId + 'Enabled');
            const previousState = checkbox ? checkbox.checked : false;
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
            fetch('/api/heatfloor/settings')
                .then(response => response.json())
                .then(data => {
                    // –ù–∞—Ö–æ–¥–∏–º –∫–∞–Ω–∞–ª –≤ –º–∞—Å—Å–∏–≤–µ
                    let channelData = null;
                    let channelObj = null;
                    
                    if (data.channels && Array.isArray(data.channels)) {
                        channelObj = data.channels.find(ch => ch.name === channelId);
                        if (channelObj && Array.isArray(channelObj.schedule)) {
                            channelData = channelObj.schedule;
                        }
                    }
                    
                    if (!channelData || !channelData[index]) {
                        showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è', 'error');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ
                    if (channelData[index].hour === hours && channelData[index].minute === minutes) {
                        console.log('–í—Ä–µ–º—è –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –∑–∞–ø—Ä–æ—Å –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è');
                        return;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
                    channelData[index].hour = hours;
                    channelData[index].minute = minutes;
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–∏—è
                    const enabled = previousState;
                    console.log(`–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ ${channelId}: ${enabled ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω'}`);
                    
                    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                    const updatedData = {
                        channels: [
                            {
                                name: channelId,
                                enabled: enabled, // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –¥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                                schedule: channelData
                            }
                        ]
                    };
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    return fetch('/api/heatfloor/settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updatedData)
                    });
                })
                .then(response => {
                    if (!response) return null; // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
                    return response.json();
                })
                .then(result => {
                    if (!result) return; // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
                    
                    if (result.success) {
                        showMessage('–í—Ä–µ–º—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                        loadHeatingSettings();
                    } else {
                        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: ' + result.message, 'error');
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏:', error);
                    showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏', 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –±–ª–æ–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        function toggleSchedule(id) {
            const content = document.getElementById(id + 'Content');
            const toggleIcon = document.getElementById(id + 'Toggle');
            
            if (content.classList.contains('collapsed')) {
                // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –±–ª–æ–∫
                content.classList.remove('collapsed');
                toggleIcon.textContent = '‚ñº';
                toggleIcon.style.transform = 'rotate(0deg)';
            } else {
                // –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –±–ª–æ–∫
                content.classList.add('collapsed');
                toggleIcon.textContent = '‚ñ∂';
                toggleIcon.style.transform = 'rotate(0deg)';
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getDayName(dayOfWeek) {
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã –¥–Ω–µ–π
            if (dayOfWeek === -1) return "–ï–∂–µ–¥–Ω–µ–≤–Ω–æ";
            if (dayOfWeek === -2) return "–ë—É–¥–Ω–∏";
            if (dayOfWeek === -3) return "–í—ã—Ö–æ–¥–Ω—ã–µ";
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ dayOfWeek –æ—Ç 0 –¥–æ 6
            // –í —Å–∏—Å—Ç–µ–º–µ: 0 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 = –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –∏ —Ç.–¥.
            const days = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
            
            if (dayOfWeek >= 0 && dayOfWeek < days.length) {
                return days[dayOfWeek];
            }
            
            return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        }
        
        function formatTime(hour, minute) {
            return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
        }
        
        function formatTimeInput(hour, minute) {
            return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventHandlers() {
            // –î–µ–ª–∞–µ–º –≤—Å–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            document.querySelectorAll('[id$="Enabled"]').forEach(checkbox => {
                checkbox.disabled = true;
            });
            
            // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤
            document.querySelectorAll('[id$="Enabled"]').forEach(checkbox => {
                const channelId = checkbox.id.replace('Enabled', '');
                
                if (channelId === 'toiletFan' || channelId === 'bathroomFan') {
                    // –û—Å–æ–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–≤
                    checkbox.addEventListener('change', function() {
                        // –î–µ–ª–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º –Ω–∞ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
                        this.disabled = true;
                        // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∫–∞–Ω–∞–ª–æ–º
                        toggleFan(channelId);
                    });
                } else {
                    // –û–±—ã—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞
                    checkbox.addEventListener('change', function() {
                        // –î–µ–ª–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º –Ω–∞ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
                        this.disabled = true;
                        toggleHeatingChannel(channelId, this.checked);
                    });
                }
            });
            
            // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            document.querySelectorAll('[id$="AddButton"]').forEach(button => {
                const channelId = button.id.replace('AddButton', '');
                button.addEventListener('click', function() {
                    addScheduleItem(channelId);
                });
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞
            loadHeatingSettings();
            loadHeatingState();
            loadFanState(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–≤
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            setInterval(loadHeatingState, 2000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            setInterval(loadFanState, 1000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–≤ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            
            // –¢–∞–π–º–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)
            setInterval(() => {
                // –ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω–æ –∏–ª–∏ –±—ã–ª–∞ –æ—à–∏–±–∫–∞ –±–æ–ª–µ–µ –º–∏–Ω—É—Ç—ã –Ω–∞–∑–∞–¥, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                if (!connectionLostTime || (new Date() - connectionLostTime) / 1000 > 60) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º –ø–µ—Ä–µ–¥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
                    fetch('/api/heatfloor/state')
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                            }
                            return response.json();
                        })
                        .then(data => {
                            // –ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏
                            const checkboxes = document.querySelectorAll('[id$="Enabled"]');
                            if (Array.from(checkboxes).every(cb => cb.disabled)) {
                                console.log('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏');
                                // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                                loadHeatingState();
                            }
                        })
                        .catch(error => {
                            console.log('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:', error);
                            // –û—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏
                        });
                }
            }, 5000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', setupEventHandlers);
    </script>
</body>
</html>